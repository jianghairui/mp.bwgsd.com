<style>
    .goods_pics{ width:80px;height: 80px;background-size: cover;background-position: center}
    .money{color:blue;font-weight: bold}
    .order-warning{color:red;font-weight: bold}
</style>
<link href="/lib/lightbox2/2.8.1/css/lightbox.css" rel="stylesheet" type="text/css" >
<article class="page-container">
    <form class="form form-horizontal" id="formAjax">
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">订单号：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <span class="">{$info.pay_order_sn}</span>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">微信端单号：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <span class="">{$info.trans_id}</span>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">订单运费：</label>
            <div class="formControls col-xs-8 col-sm-3">
                <span class="money">￥：{$info.carriage}</span>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">订单金额(含运费)：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <span class="money">￥：{$info.total_price}</span>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">实际支付：</label>
            <div class="formControls col-xs-8 col-sm-3">
                <span class="money">￥：{$info.pay_price}</span>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">下单时间：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <span class="">{$info.create_time|date='Y-m-d H:i:s'}</span>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">支付时间：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <span class="">{if $info['pay_time']}{$info.pay_time|date='Y-m-d H:i:s'}{/if}</span>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">订单状态：</label>
            <div class="formControls col-xs-8 col-sm-9">
                {switch $info['status']}
                {case 0}
                <span class="label label-defaunt radius">待支付</span>{/case}
                {case 1}
                <span class="label label-warning radius">待发货</span>{/case}
                {case 2}
                <span class="label label-primary radius">待收货</span>{/case}
                {case 3}
                <span class="label label-success radius">已完成</span>{/case}
                {default /}
                {/switch}
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">退款状态：</label>
            <div class="formControls col-xs-8 col-sm-9" id="refund-status">
                {switch $info['refund_apply']}
                {case 0}
                <span class="label label-defaunt radius">无退款</span>{/case}
                {case 1}
                <span class="label label-danger radius">申请退款</span>{/case}
                {case 2}
                <span class="label label-success radius">已退款</span>{/case}
                {default /}
                {/switch}
            </div>
        </div>
        {if $info['refund_apply']}
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">申请退款时间：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <span class="">{if $info['refund_apply_time']}{$info.refund_apply_time|date='Y-m-d H:i:s'}{/if}</span>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">退款时间：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <span class="">{if $info['refund_time']}{$info.refund_time|date='Y-m-d H:i:s'}{/if}</span>
            </div>
        </div>
        {/if}
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">退款理由：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <span class="order-warning">{$info.reason}</span>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">收货人：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <span class="">{$info.receiver}</span>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">手机号：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <span class="">{$info.tel}</span>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">收货地址：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <span class="">{$info.address}</span>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">发货时间：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <span class="">{if $info['send_time']}{$info.send_time|date='Y-m-d H:i:s'}{/if}</span>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">订单完成时间：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <span class="">{if $info['finish_time']}{$info.finish_time|date='Y-m-d H:i:s'}{/if}</span>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">快递类型：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <span class="">{$info.tracking_name}</span>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">物流单号：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <span class="">{$info.tracking_num}</span>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">订单详情：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div style="display: flex;flex-wrap: wrap">
                    {foreach $info['order_detail'] as $vv}
                    <div style="width: 400px;flex-grow: 1;display: flex;margin-bottom: 8px">
                        <div id="cover" class="goods_pics" style="flex-shrink:0;background-image: url('/{$vv.cover}');"></div>
                        <div style="margin: 0 10px;flex-grow: 1;width: 0">
                            <div style="width: 100%">
                                <span class="order-font-b" title="{$vv.goods_name}" style="display: block;white-space: nowrap;text-overflow: ellipsis;overflow: hidden">{$vv.goods_name}</span></div>
                            <div>规格: <span class="order-font">{$vv.attr}</span></div>
                            <div>数量: <span class="order-font">{$vv.num}</span></div>
                            <div>小计: <span class="order-font">{$vv.total_price}元</span></div>
                        </div>
                    </div>
                    {/foreach}
                </div>
            </div>
        </div>
        <div class="row cl">
            <div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
                {if $info['refund_apply'] == 1}
                <button onClick="order_refund(this,'{$info.id}');" class="btn btn-danger radius" type="button">&nbsp;&nbsp;退款&nbsp;&nbsp;</button>
                {/if}
                <input class="btn btn-primary radius" onclick="layer_close()" type="submit" value="&nbsp;&nbsp;关闭选项卡&nbsp;&nbsp;">
            </div>
        </div>
        <div class="row cl"></div>
    </form>
</article>

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="/lib/lightbox2/2.8.1/js/lightbox.min.js"></script>
<script type="text/javascript" src="/lib/jquery.validation/1.14.0/jquery.validate.js"></script>
<script type="text/javascript" src="/lib/jquery.validation/1.14.0/validate-methods.js"></script>
<script type="text/javascript" src="/lib/jquery.validation/1.14.0/messages_zh.js"></script>
<script type="text/javascript">

    $(function(){});

    var click_lock = true;

    function order_refund(obj,id) {
        layer.confirm('确认要退款吗？',function(index){
            if(click_lock) {
                click_lock = false;
                $.ajax({
                    url: "{:url('Shop/orderRefund')}",
                    type: 'POST',
                    dataType: 'json',
                    data:{id:id},
                    success: function(data){
                        // console.log(data);return;
                        if(data.code == 1) {
                            $("#refund-status").html('<span class="label label-success radius">已退款</span>');
                            $(obj).remove();
                            layer.msg('已退款!',{icon:1,time:1000});
                        }else {
                            layer.msg(data.data,{icon:2,time:1000});
                        }
                    },
                    error:function(data) {
                        layer.msg('接口请求失败',{icon:5,time:1000});
                    }
                });
            }

        });
    }


</script>